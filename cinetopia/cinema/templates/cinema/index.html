{% extends 'cinema/base.html' %}
{% load static %}

{% block title %}Главная страница{% endblock %}

{% block main %}
    <main>
        <section class="hero">
            <div class="container">
                <h2>Популярные фильмы</h2>
                <div class="carousel">
                    <button class="carousel-btn prev" disabled>&lt;</button>
                    <div class="carousel-wrapper">
                        <ul class="movie-list">
                            {% for movie in movies %}
                                <li class="movie-item">
                                    <a href="{% url 'movie_detail' movie.slug %}">
                                        <img src="{{ movie.poster.url }}" alt="Фильм {{ movie.title }}">
                                        {% if movie.avg_rating %}
                                            <span class="rating rating-{{ movie.avg_rating|floatformat:"0" }}">
                                    {{ movie.avg_rating|floatformat:1 }}
                                    </span>
                                        {% else %}
                                            <span class="rating rating-none">0</span>
                                        {% endif %}
                                        <h3 class="item-component">{{ movie.title }}</h3>
                                        <h4 class="item-component">{{ movie.release_year }}</h4>
                                        <p class="item-component">{{ movie.genres.all|slice:"0:4"|join:', ' }}</p>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <button class="carousel-btn next">&gt;</button>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
{% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const carousel = document.querySelector('.movie-list');
            const prevBtn = document.querySelector('.carousel-btn.prev');
            const nextBtn = document.querySelector('.carousel-btn.next');
            const movieItems = document.querySelectorAll('.movie-item');
            const itemWidth = movieItems[0].offsetWidth + 20; // width + gap
            let position = 0;
            const maxPosition = -itemWidth * (movieItems.length - 5);

            function updateButtons() {
                prevBtn.disabled = position === 0;
                nextBtn.disabled = position <= maxPosition;
            }

            prevBtn.addEventListener('click', function () {
                if (position < 0) {
                    position += itemWidth;
                    carousel.style.transform = `translateX(${position}px)`;
                    updateButtons();
                }
            });

            nextBtn.addEventListener('click', function () {
                if (position > maxPosition) {
                    position -= itemWidth;
                    carousel.style.transform = `translateX(${position}px)`;
                    updateButtons();
                }
            });

            updateButtons();
        });
    </script>
{% endblock %}