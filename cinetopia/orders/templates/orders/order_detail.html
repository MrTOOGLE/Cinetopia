{% extends "cinema/base.html" %}
{% load static %}

{% block title %}
  –ó–∞–∫–∞–∑ {{ order.id }} | üéüÔ∏èCinetopia
{% endblock %}
{% block head %}
  <link rel="stylesheet" href="{% static "orders/css/order_detail.css" %}">
{% endblock %}
{% block main %}
  <div class="order-detail-container">
    <div class="order-detail-header">
      <h1 class="order-detail-title">–ó–∞–∫–∞–∑ #{{ order.id }}</h1>
      <div class="order-detail-status {{ order.status }}">
        {{ order.get_status_display }}
      </div>
    </div>

    <div class="order-detail-grid">
      <div class="order-detail-items">
        <h2 class="order-detail-subtitle">–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h2>

        <div class="order-items-list">
          {% for item in order.items.all %}
            <div class="order-detail-item">
              <div class="order-item-image">
                {% if item.product.image %}
                  <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                {% endif %}
              </div>

              <div class="order-item-info">
                <h3 class="order-item-name">{{ item.product.name }}</h3>
                <div class="order-item-meta">
                  <span class="order-item-price">{{ item.price }} ‚ÇΩ</span>
                  <span class="order-item-quantity">√ó {{ item.quantity }}</span>
                  {% if item.discount %}
                    <span class="order-item-discount">–°–∫–∏–¥–∫–∞ {{ item.discount }}%</span>
                  {% endif %}
                </div>
              </div>

              <div class="order-item-total">
                {{ item.get_cost }} ‚ÇΩ
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="order-summary">
          <div class="order-summary-row">
            <span>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</span>
            <span>{{ order.get_total_cost_before_discount }} ‚ÇΩ</span>
          </div>
          {% if order.discount %}
            <div class="order-summary-row">
              <span>–°–∫–∏–¥–∫–∞:</span>
              <span class="text-discount">-{{ order.discount }}%</span>
            </div>
          {% endif %}
          <div class="order-summary-row total">
            <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
            <span class="order-total-price">{{ order.get_total_cost }} ‚ÇΩ</span>
          </div>
        </div>
      </div>

      <div class="order-detail-info">
        <h2 class="order-detail-subtitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h2>

        <div class="order-info-card">
          <div class="order-info-section">
            <h3 class="order-info-title">–î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
            <div class="order-info-content">
              <p>{{ order.user.username }}</p>
              <p>{{ order.user.email }}</p>
              <p>{{ order.phone }}</p>
            </div>
          </div>

          <div class="order-info-section">
            <h3 class="order-info-title">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
            <div class="order-info-content">
              <p>{{ order.country }}, {{ order.city }}</p>
              <p>{{ order.address }}</p>
            </div>
          </div>

          <div class="order-info-section">
            <h3 class="order-info-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
            <div class="order-info-content">
              <p><strong>–î–∞—Ç–∞:</strong> {{ order.created|date:"d.m.Y H:i" }}</p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ order.get_status_display }}</p>
              <p><strong>–û–ø–ª–∞—Ç–∞:</strong> {% if order.paid %}–û–ø–ª–∞—á–µ–Ω{% else %}–ù–µ –æ–ø–ª–∞—á–µ–Ω{% endif %}</p>
            </div>
          </div>

          {% if order.note %}
            <div class="order-info-section">
              <h3 class="order-info-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
              <div class="order-info-content">
                <p>{{ order.note }}</p>
              </div>
            </div>
          {% endif %}
        </div>

        <a href="{% url 'account' %}" class="back-to-orders">
          ‚Üê –í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        </a>
      </div>
    </div>
  </div>

{% endblock %}