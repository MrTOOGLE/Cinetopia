{% extends "cinema/base.html" %}
{% load static %}

{% block title %}
  –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | üéüÔ∏èCinetopia
{% endblock %}
{% block head %}
  <link rel="stylesheet" href="{% static "user/css/account.css" %}">
{% endblock %}
{% block main %}
<main class="account-container">
    <div class="account-sidebar">
      <div class="account-header">
        <div class="account-avatar">
          {% if user.profile.avatar %}
            <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}">
          {% else %}
            <div class="avatar-placeholder">{{ user.username|first|upper }}</div>
          {% endif %}
        </div>
        <h1 class="account-username">{{ user.username }}</h1>
        <a href="#" class="edit-profile-btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
      </div>
      
      <nav class="account-nav">
        <ul>
          <li class="active"><a href="#profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
          <li><a href="#movies">–ú–æ–∏ —Ñ–∏–ª—å–º—ã</a></li>
          <li><a href="#orders">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a></li>
          <li><a href="#settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
        </ul>
      </nav>
    </div>
    
    <div class="account-content">
      <section id="profile" class="account-section">
        <h2 class="section-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="profile-info">
          <div class="info-row">
            <span class="info-label">–ò–º—è:</span>
            <span class="info-value">{{ user.first_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">–§–∞–º–∏–ª–∏—è:</span>
            <span class="info-value">{{ user.last_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Email:</span>
            <span class="info-value">{{ user.email }}</span>
          </div>
          {% if user.profile.birth_date %}
            <div class="info-row">
              <span class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
              <span class="info-value">{{ user.profile.birth_date|date:"d.m.Y" }}</span>
            </div>
          {% endif %}
          {% if user.profile.phone %}
            <div class="info-row">
              <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
              <span class="info-value">{{ user.profile.phone }}</span>
            </div>
          {% endif %}
          {% if user.profile.bio %}
            <div class="info-row">
              <span class="info-label">–û —Å–µ–±–µ:</span>
              <p class="info-bio">{{ user.profile.bio }}</p>
            </div>
          {% endif %}
        </div>
      </section>
      
      <section id="movies" class="account-section">
        <h2 class="section-title">–ú–æ–∏ —Ñ–∏–ª—å–º—ã</h2>
        
        <div class="movie-stats">
          {% for stat in movie_stats %}
            <div class="stat-item">
              <span class="stat-count">{{ stat.count }}</span>
              <span class="stat-label">{{ stat.list_name }}</span>
            </div>
          {% endfor %}
        </div>
        
        <h3 class="subsection-title">–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ</h3>
        <div class="recent-movies">
          {% for item in recent_movies %}
            <div class="movie-card">
              <a href="{{ item.movie.get_absolute_url }}">
                {% if item.movie.poster %}
                  <img src="{{ item.movie.poster.url }}" alt="{{ item.movie.title }}">
                {% else %}
                  <div class="movie-poster-placeholder"></div>
                {% endif %}
                <span class="movie-badge {{ item.list_type }}">{{ item.get_list_type_display }}</span>
                <h4 class="movie-title">{{ item.movie.title }}</h4>
              </a>
            </div>
          {% empty %}
            <p class="empty-message">–í—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞</p>
          {% endfor %}
        </div>
        
        <a href="/" class="view-all-link">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</a>
      </section>
      
      <section id="orders" class="account-section">
        <h2 class="section-title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
        
        {% if recent_orders %}
          <div class="orders-list">
            {% for order in recent_orders %}
              <div class="order-card">
                <div class="order-header">
                  <span class="order-number">–ó–∞–∫–∞–∑ #{{ order.id }}</span>
                  <span class="order-date">{{ order.created|date:"d.m.Y" }}</span>
                  <span class="order-status {{ order.status }}">{{ order.get_status_display }}</span>
                </div>
                <div class="order-total">–°—É–º–º–∞: {{ order.get_total_cost }} ‚ÇΩ</div>
                <a href="{% url 'order_detail' order.id %}" class="order-details-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
              </div>
            {% endfor %}
          </div>
          <a href="{% url 'user_orders' %}" class="view-all-link">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</a>
        {% else %}
          <p class="empty-message">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
        {% endif %}
      </section>
    </div>
  </main>
{% endblock %}